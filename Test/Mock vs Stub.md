회사가 이상한걸까? G-Test 를 자꾸 Mock Test 라 그러고 막상 안을 까보면 Stub이다.
그래서 너무 헷갈려서 비교


# 🧪 테스트 더블(Test Double) 정리 — Stub vs Mock vs Test

## 1️⃣ 테스트 더블(Test Double)이란?

테스트 더블은 **실제 객체를 테스트 중에 대체**하는 모든 객체를 통칭하는 개념.  
예를 들어, 외부 시스템(DB, 네트워크 등)에 의존하는 로직을 테스트할 때, **실제 객체를 쓰면 느리거나 불안정**할 수 있기 때문에, 이를 **더블(Double)**로 바꿔서 사용.
-> HUser Test를 진행할때, 실제 앱쪽의 호출부까지 테스트 할 수 없으니 직접 박아서 사용하는 것.

### 주요 종류

| 종류     | 설명 |
|----------|------|
| Dummy    | 값만 채워넣는 객체 (아무 동작 없음) |
| Fake     | 실제보다 단순한 버전 (ex. 인메모리 DB) |
| **Stub** | 고정된 값을 리턴 (응답 중심) |
| **Mock** | 함수 호출 여부/횟수/순서 등 검증 (행위 중심) |
| Spy      | 진짜 객체를 감싸고 호출 정보 기록 |

# Dilema

즉, 사내 mock test 기준으로 Mock 테스트를 완전 잘못 하고 있는 것.. ㅇㅅㅇ,, 그냥 단순한 stub test라고 볼 수 있다 (심지어 결과도 틀린)
-> code coverage 만 달성한다고 mock test라고 우길 수 있는 것일까?

## 🧪 Mock Test vs 코드 커버리지

### 1. 코드 커버리지(Code Coverage)란?

> **테스트 실행 시, 전체 코드 중 몇 %가 실제로 실행됐는지를 나타내는 지표**

### 예:
- `if`, `for`, `return` 같은 조건이나 분기문이 테스트 실행 중 **지나갔는지 확인**하는 지표
- 커버리지는 **“테스트가 해당 줄을 실행했는가”**만 확인하지,
  - 그 줄에서 어떤 동작이 일어났는지,
  - 올바른 방식으로 호출되었는지는 알 수 없음

---

### 2. Mock Test란?

> **테스트 대상이 외부 객체(HAL, 서비스 등)와 “어떻게 상호작용했는지”를 검증하는 테스트**

### Mock Test의 목적
- 함수가 **정확히 호출됐는지**
- **몇 번 호출됐는지**
- 어떤 **인자를 전달했는지**
- 호출 **순서가 맞는지** 등을 **명시적으로 검증**

### GTest 예시:

```cpp
EXPECT_CALL(mockHal, Init()).Times(1);
EXPECT_CALL(mockHal, SendData(_, _)).Times(AtLeast(1));
```

## Mock Test?

### Stub + EXPECT_EQ() = Mock Test?
현재 인도연과 개발한 g-test는 애매한 녀석임. 딱히 mock test도 gtest도 아님.

```cpp
// Stub처럼 응답만 고정
ON_CALL(stubImpl, GetUserName()).WillByDefault(Return("홍길동"));

// 실제 테스트에서는 호출 여부는 확인 안 하고, 결과만 비교
std::string result = myService.CallUserName();
EXPECT_EQ(result, "홍길동");
```

코드 커버리지는 올라감
✅ Stub을 통해 응답은 통제함
❌ 하지만 호출 여부, 횟수, 인자는 검증하지 않음
→ 따라서, 이건 Mock Test가 아니라 Stub Test + 상태 검증 테스트임

## Mock Test vs Stub Test vs 코드 커버리지 비교

### 핵심 차이

| 항목                             | 코드 커버리지                | Stub Test                           | Mock Test                              |
|----------------------------------|------------------------------|-------------------------------------|-----------------------------------------|
| **목적**                         | 코드가 실행됐는지            | 정해진 응답을 리턴                  | 함수 호출 여부/횟수/인자 등을 검증      |
| **도구**                         | `gcov`, `lcov` 등            | `ON_CALL()` + `Return()`           | `EXPECT_CALL()` + `Times()`            |
| **대표 검증 방식**               | 실행 라인 체크               | `EXPECT_EQ()`로 결과 비교           | 함수 호출 조건 직접 지정               |
| **테스트 대상과의 상호작용 확인** | ❌ 안 됨                      | ❌ 안 됨                             | ✅ 명시적으로 검증함                    |
| **Mock Test라고 할 수 있는가?**  | ❌                           | ❌                                  | ✅                                      |

---

### 이런 경우는 Mock Test일까?

| 케이스                  | 설명                                      | Mock Test로 간주 가능? |
|--------------------------|-------------------------------------------|--------------------------|
| `ON_CALL()`만 사용       | 함수 응답만 설정하고 호출 검증 없음       | ❌ Stub Test             |
| `EXPECT_EQ()`로 값 비교  | Stub 응답 받아서 상태만 확인              | ❌ Stub + 상태 검증     |
| `EXPECT_CALL()` 사용     | 호출 여부/횟수/인자 등을 검증             | ✅ 진짜 Mock Test        |

---

### 결론 요약

- **Mock Test**란, 함수 호출의 "행위"를 검증하는 테스트임
- `ON_CALL()` + `EXPECT_EQ()`만으로는 Mock Test라고 부를 수 없음
- GTest를 사용했다고 해서 모든 테스트가 Mock Test는 아님
- **진짜 Mock Test**는 `EXPECT_CALL()` 기반의 **행위 기반 검증**을 반드시 포함해야 함
- 즉 회사에서 하고 있는 방식은 그냥 `Stub Test` + 상태 검증 테스트임

---

다시 주제로 돌아와서,

## 2. Stub vs Mock: 핵심 차이

| 항목       | Stub                                      | Mock                                               |
|------------|-------------------------------------------|----------------------------------------------------|
| 목적       | **정해진 응답값**을 리턴                  | **함수 호출 여부/횟수/순서/인자**를 검증            |
| 검증 대상 | 결과값                                     | 행위(behavior)                                    |
| 사용 예   | "이 함수는 입력값에 대해 이 값을 반환해야 해" | "이 함수가 정확히 1번 호출됐는지 확인하고 싶어"     |
| 예시 코드 (GTest) | `ON_CALL(obj, func).WillByDefault(Return(val));` | `EXPECT_CALL(obj, func).Times(1);`                  |

---

## 3. 일반 테스트와 테스트 더블 비교

| 항목           | 일반 테스트 (`TEST()`)                     | Test Double (Stub/Mock)                       |
|----------------|----------------------------------------------|------------------------------------------------|
| 실제 객체 사용 | O                                            | X (더블로 대체)                               |
| 목적           | 전체 로직 테스트                             | 특정 동작 or 응답만 테스트                     |
| 예시           | 진짜 DB 연결해서 사용자 정보 가져오기       | 가짜 DB에서 사용자 정보 리턴하도록 설정        |
| 장점           | 현실 반영                                     | 빠르고 안정적인 테스트                         |
| 단점           | 느리고 불안정, 외부 의존성 문제 가능         | 실제와 다를 수 있음                            |

---

## 4. GTest에서 Stub vs Mock

> GTest (Google Test) 라이브러리를 사용한다고 해서 **모든 테스트가 Mock Test는 아닙니다.**

GMock은 GTest에 포함된 모킹 프레임워크이며, `ON_CALL()`과 `EXPECT_CALL()` 모두 사용할 수 있습니다.  
그러나 **사용 방식에 따라 Stub인지, Mock인지**가 결정됩니다.

### Stub처럼 쓰는 경우:

```cpp
ON_CALL(mockObj, GetUser()).WillByDefault(Return("홍길동")); // 응답 설정만 함
```
